# instruction-no-ssl

Документ для агента Cursor. Цель ― разрешить работе с `gigachat` как с установленным корневым сертификатом, так и без него, управляя проверкой TLS через конфигурацию. Никаких изменений библиотек не требуется.

## План правок

1. **Новый флаг конфигурации.** Добавить в `backend/config.py` булеву опцию `GIGACHAT_VERIFY_SSL_CERTS`, которая читается из переменной окружения `GIGACHAT_VERIFY_SSL_CERTS`. Значение по умолчанию — `true`. Преобразование строки в bool делай по тому же принципу, что и уже существующие флаги (`TEST_MODE` и т.п.): `"false"`, `"0"`, `"no"` → `False`, иначе `True`.
2. **Обновить `backend/llm/gigachat_helper.py`.**
   - Забрать новое значение из `Config` и использовать переменную `verify_ssl`.
   - Проверку существования файла сертификата и передачу `ca_bundle_file` выполняем **только** если `verify_ssl` истинно.
   - Если проверка отключена, не требуй файл сертификата и не выходи с ошибкой; вместо этого логируй `warning`, что SSL-валидация отключена.
   - Сформируй `giga_kwargs` с обязательным `credentials` и `verify_ssl_certs=verify_ssl`. Добавляй `ca_bundle_file=cert_path` лишь при включённой проверке.
   - Сообщения для пользователя оставь русскими, но обнови текст, чтобы в ветке без сертификата не упоминалось требование файла.
3. **Документация.**
   - В `env.example` (и в соответствующем примере блока `.env` в `README.md`) добавь строку `GIGACHAT_VERIFY_SSL_CERTS=true` с коротким комментарием, что `false` позволяет работать без корневого сертификата (на свой риск).
   - В разделе README про GigaChat допиши абзац, объясняющий, что переменная `GIGACHAT_VERIFY_SSL_CERTS=false` отключает проверку сертификата, и подчеркни риски безопасности.

## Детали реализации

- В `backend/config.py` удобно завести небольшой приватный helper, например `_get_bool(key: str, default: str = "false") -> bool`, чтобы не дублировать преобразование строк в bool. Если не хочешь вводить helper, напиши выражение в одну строку по аналогии с `TEST_MODE`.
- В `gigachat_helper` следи за тем, чтобы `logger.warning` срабатывал только при `verify_ssl` выключенном, иначе журнал зашумится.
- Возвращаемые пользователю строки (ответы при отсутствии credentials или ошибок) должны остаться в стиле текущего файла; просто убери упоминание обязательного сертификата из ветки, которая теперь выполняется условно.

## Проверка

1. `pytest -q` из корня (убедись, что тесты проходят с `TEST_MODE=true`).
2. Локально прогонять приложение не требуется, но можно быстро вручную вызвать `python - <<'PY' ...` и убедиться, что импорт `backend.llm.gigachat_helper` работает при отсутствии `GIGACHAT_CERT_PATH`, если в `.env` прописать `GIGACHAT_VERIFY_SSL_CERTS=false`.

## Готовность задачи

- Новая переменная окружения задокументирована.
- При `GIGACHAT_VERIFY_SSL_CERTS=false` приложение не требует файл `russian_trusted_root_ca.cer`, не падает при его отсутствии и логирует предупреждение.
- При значении `true` поведение остаётся прежним: без сертификата появляется понятная ошибка.
